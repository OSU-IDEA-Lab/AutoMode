#Automode: An automatic language bias generator system 

Following is the more generalized steps to run Automode for any dataset such as Immortals, UWCSE, IMDB, HIV, CORA,
WebKB.
 
##Steps to run on UWCSE dataset:

Setup the dataset in Voltdb
```sh
    $ sh examples/uwcse/load.sh
```
    
Run: examples/uwcse/run.sh to run the Automode. This script does two things: 

1.  It runs the profiling algorithm to generate the inclusion dependency(DB tables and target query tables included)
2.  It runs AutoMode setup client to generate the modes. The script uses inds generated in step-1 
    
Examples in Files:

```sh
    $ sh run.sh -examplesRelation advisedby -examplesRelationSuffix dby -- approximate 0.5 automode-input/setup_inds.txt out/dataModel_advisedby.json abs 5 advisedby UWCSEProcedure 
```      
Examples in database:

```sh
    $ sh run.sh -examplesFile target/advisedby.csv -examplesRelationSuffix dby -- approximate 0.5 automode-input/setup_inds.txt out/dataModel_advisedby.json abs 5 advisedby UWCSEProcedure 
```      

Script Parameters:

```sh       -examplesRelation       :   Provides the name of relation having examples      
            -examplesRelationSuffix :   Helps distinguish example tables from db tables. 
                                        Restricts the participation of example tables in INDs. 
                                        This is required in cases where there are many target tables populated in db.
                                        Having exampleRelation and examplesRelationSuffix toegther ensures that only 
                                        given exampleRelation is included in IND, no other examples tables are allowed 
                                        to particiapte in IND.      
            -examplesFile           :   Example file location                                                         
            -algorithm              :   exact/approximate
            -maxIndError            :   This is to specify exact or approximation inclusion dependency 0 for exact
            -inputIndFilePath       :   Path to save intermediate ind file generated by Profiling algorithm
            -outModeFilePath        :   Path to save output Mode file generated by AutoMode
            -constThresholdType     :   Specify threshold type (abs or pctg)
            -constThresholdValue    :   Threshold value
            -target                 :   target query(advisedby)
            -storedProcedure        :   stored procedure name to be used by Castor   

```     

Mode is generated and stored under "out" directory and other intermediate results such as setup_inds.txt are stored under automode-input directory           


##Steps to run on Immortals dataset:

Setup the dataset in Voltdb with all the examples relations

```sh
    $ sh examples/immortals/load.sh
```

### One step method    

Run: examples/immortals/run.sh to run the Automode. run.sh script will generate modes for all queries from query1 - query9. This script does two things:

1.  It calls the setup.sh script to generate the base modes 
2.  It calls the run_script.sh to generate the query specific modes 

```sh
    $ sh run.sh -examplesRelationSuffix _all_pos -- exact 0 automode-input/setup_inds.txt automode-input/setup_modes.json pctg 18 automode-input/manual-constants
```    

Script Parameters:
```sh
            -algorithm              :   exact/approximate
            -maxIndError            :   This is to specify exact or approximation inclusion dependency 0 for exact
            -inputIndFilePath       :   Path to save intermediate ind file generated by Profiling algorithm            
            -inputModeFilePath      :   Path to save intermediate Mode file generated by AutoMode
            -constThresholdType     :   Specify threshold type (abs or pctg)
            -constThresholdValue    :   Threshold value
            -schema                 :   Specify schema.json file, this helps in differentiating db tables and query tables
            -manualTunedConstants   :   Path to manual constants language file 
```       

Mode is generated and stored under "out" directory and other intermediate results such as setup_inds.txt are stored under automode-input directory           
    

### Two step method 

####Run: examples/immortals/setup.sh to generate the base modes. 
The script does two things:

1.  It runs the profiling algorithm to generate the inclusion dependency(target query tables will be omitted)
2.  It runs AutoMode setup client to generate the base modes. The script uses inds generated in previous step 

```sh     
    sh setup.sh -examplesRelationSuffix _all_pos -- exact 0.0 automode-input/setup_inds.txt automode-input/setup_modes.json pctg 18 automode-input/manual-constants
```
    
Script Parameters:

```sh
            -algorithm              :   exact/approximate
            -maxIndError            :   This is to specify exact or approximation inclusion dependency 0 for exact
            -inputIndFilePath       :   Path to save intermediate ind file generated by Profiling algorithm            
            -outModeFilePath        :   Path to save intermediate Mode file generated by AutoMode
            -constThresholdType     :   Specify threshold type (abs or pctg)
            -constThresholdValue    :   Threshold value
            -manualTunedConstants   :   Path to manual constants language file 
            -schema                 :   Specify schema.json file, this helps in differentiating db tables and query tables
```     

             
    
####Run: examples/immortals/run_query.sh to generate the final modes. 
The script does two things:

1.  It runs the profiling algorithm to generate the one way inclusion dependency. 
    This step will extract the inclusion dependency between target query table and rest of database schema        
2.  The one way inds and setup modes generated in step-1 will now be used to generate the final modes to learn target query.
    It runs AutoMode per query client to generate the final modes for given target query
    
Examples in db

```sh
    $ sh run_query.sh -examplesRelation query1_all_pos -examplesRelationSuffix _all_pos  --  query1 automode-input/setup_inds.txt automode-input/setup_modes.json out/dataModel_query1.json 0 CastorProcedure_query1
```  

Examples in file
```sh
    $ sh run_query.sh -examplesFile target/query2_all_pos.csv -examplesRelationSuffix _all_pos  --  query2 automode-input/setup_inds.txt automode-input/setup_modes.json out/dataModel_query2.json 0 CastorProcedure_query2
```   
   
Script Parameters:
```sh
            -target                 :   Query to be learned by castor
            -schema                 :   Specify schema.json file, this helps in differentiating db tables and query tables
            -inputIndFile           :   Path to save intermediate ind file generated by Profiling algorithm            
            -inputModeFile          :   Path to save intermediate Mode file generated by AutoMode
            -outputModeFile         :   Path to save final Mode file generally stored in out directory
            -maxIndError            :   This is to specify exact or approximation inclusion dependency 0 for exact
            -storedProcedure        :   stored procedure name to be used by Castor            
 
 ```      

This step will generate the final mode for given target which is now ready to be used by castor
     


 
 
 
 
 
 